{"version":3,"file":"static/js/905.0a101121.chunk.js","mappings":"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","sources":["blocks/preview/index.js"],"sourcesContent":["import Liam from '@liam-js/liam';\nimport './index.css';\n\nlet __previewErrors = [];\nwindow.addEventListener('error', (event) => {\n  let message = event.message;\n  if (event.filename) {\n    message += '\\n' + event.filename.replace(window.location.origin, '');\n  }\n  if (event.lineno || event.colno) {\n    message += ':' + event.lineno + ':' + event.colno;\n  }\n  // print error stack info\n  const hasStack = !!event.error && !!event.error.stack;\n  const stack = (hasStack && event.error.stack.toString()) || '';\n  __previewErrors.push({\n    message: message,\n    stack: stack,\n  });\n});\n\nwindow.addEventListener(\n  'error',\n  (event) => {\n    const target = event.target;\n    // only catch resources error\n    if (\n      ['link', 'video', 'script', 'img', 'audio'].indexOf(target.localName) > -1\n    ) {\n      const src = target.href || target.src || target.currentSrc;\n      __previewErrors.push({\n        message: `GET <${target.localName}> error: ${src}`,\n        stack: '',\n      });\n    }\n  },\n  true\n);\nwindow.addEventListener('unhandledrejection', (e) => {\n  let error = e && e.reason;\n  const errorName = 'Uncaught (in promise) ';\n  let args = {\n    message: errorName,\n    stack: error,\n  };\n  if (error instanceof Error) {\n    args = {\n      message: errorName,\n      stack: {\n        name: error.name,\n        message: error.message,\n        stack: error.stack,\n      },\n    };\n  }\n  __previewErrors.push(args);\n});\n\nvar getParam = function (key) {\n  var params = window.location.search.split('?')[1];\n  if (params) {\n    var arr = params.split('&');\n    for (var i = 0; i < arr.length; i++) {\n      var data = arr[i].split('=');\n      if (data[0] === key) {\n        return data[1];\n      }\n    }\n  }\n};\nlet textUrl = getParam('url');\ntextUrl = decodeURIComponent(textUrl);\n\n// https://github.com/niksy/throttle-debounce\nfunction throttle(delay, noTrailing, callback, debounceMode) {\n  var timeoutID;\n  var cancelled = false; // Keep track of the last time `callback` was executed.\n\n  var lastExec = 0; // Function to clear existing timeout\n\n  function clearExistingTimeout() {\n    if (timeoutID) {\n      clearTimeout(timeoutID);\n    }\n  }\n\n  function cancel() {\n    clearExistingTimeout();\n    cancelled = true;\n  }\n  if (typeof noTrailing !== 'boolean') {\n    debounceMode = callback;\n    callback = noTrailing;\n    noTrailing = undefined;\n  }\n\n  function wrapper() {\n    for (\n      var _len = arguments.length, arguments_ = new Array(_len), _key = 0;\n      _key < _len;\n      _key++\n    ) {\n      arguments_[_key] = arguments[_key];\n    }\n\n    var self = this;\n    var elapsed = Date.now() - lastExec;\n\n    if (cancelled) {\n      return;\n    }\n\n    function exec() {\n      lastExec = Date.now();\n      callback.apply(self, arguments_);\n    }\n\n    function clear() {\n      timeoutID = undefined;\n    }\n\n    if (debounceMode && !timeoutID) {\n      exec();\n    }\n\n    clearExistingTimeout();\n\n    if (debounceMode === undefined && elapsed > delay) {\n      exec();\n    } else if (noTrailing !== true) {\n      timeoutID = setTimeout(\n        debounceMode ? clear : exec,\n        debounceMode === undefined ? delay - elapsed : delay\n      );\n    }\n  }\n\n  wrapper.cancel = cancel; // Return the wrapper function.\n  return wrapper;\n}\n// 用于开发和本地快速测试使用\nconst isIframe = window.self !== window.top;\nconst isOpener = !!window.opener;\n\nconst urls = [];\nif (isIframe || isOpener) {\n  urls.push('//e.sinaimg.cn/ssfe/liam/js/editor/popupWindowMessageManager.js');\n} else {\n  urls.push('text!' + textUrl);\n  urls.push('text!https://e.sinaimg.cn/ssfe/liam/js/editor/float-action-button.js');\n}\n\nLiam.require(\n  urls,\n  function (PopupWindowMessageManagerOrSchema, floatButtonText) {\n    // 使用容器包裹文字，方便定位; 但有些文字处理类的组件，文字包裹后会出错，如动画文字 reat-reveal-text\n    Liam.config({\n      wrapText: true,\n    });\n\n    const focusComponent = function (pos, scrollInto) {\n      if (Array.isArray(pos)) {\n        pos = pos.join('-');\n      }\n      const focusElement = document.querySelector('.pe-focus');\n      const currentElement = document.querySelector('[__loc=\"' + pos + '\"]');\n      if (focusElement) {\n        focusElement.classList.remove('pe-focus');\n      }\n      if (currentElement) {\n        currentElement.classList.add('pe-focus');\n        if (scrollInto) {\n          currentElement.scrollIntoView({\n            block: 'center',\n            inline: 'center',\n          });\n        }\n      }\n    };\n\n    const render = throttle(200, function (text) {\n      try {\n        let js = Liam.toJs(text?text.trim():'');\n        if (!isIframe || isOpener) {\n          js = [\n            Liam.toJs(floatButtonText, {\n              text: text,\n            }),\n            js,\n          ];\n        }\n        Liam.render(js, document.querySelector('#root'));\n      } catch (error) {\n        console.log(error);\n      }\n    });\n\n    if (!isIframe && !isOpener) {\n      // 单独打开页面，直接渲染\n      render(PopupWindowMessageManagerOrSchema);\n    } else {\n      const sendError = throttle(1000, function () {\n        setTimeout(function () {\n          if (__previewErrors.length !== 0) {\n            MM1.post({\n              type: 'preview-error',\n              value: __previewErrors,\n            });\n            __previewErrors = [];\n          }\n        }, 0);\n      });\n      // 预览页错误\n      window.addEventListener('error', function () {\n        sendError();\n      });\n      window.addEventListener('unhandledrejection', function () {\n        sendError();\n      });\n\n      // iframe形式打开页面，则等待父页面给数据，再渲染\n      var MM1 = new PopupWindowMessageManagerOrSchema(\n        isOpener ? window.opener : window.parent\n      );\n\n      MM1.on(function (data) {\n        if (data.type && data.type === 'change') {\n          render(data.value);\n          sendError();\n        }\n\n        if (data.type && data.type === 'cursor') {\n          focusComponent(data.value, true);\n        }\n      });\n      MM1.post({\n        type: 'preview-loaded',\n      });\n\n      // 点击组件高亮\n      document.querySelector('body').addEventListener('click', function (e) {\n        let el = e.target;\n        while (el && el.getAttribute && !el.getAttribute('__loc')) {\n          el = el.parentNode;\n        }\n        if (el && el.getAttribute) {\n          const __loc = el.getAttribute('__loc');\n          if (__loc) {\n            MM1.post({\n              type: 'preview-click',\n              value: __loc,\n            });\n            focusComponent(__loc);\n          }\n        }\n      });\n    }\n  }\n);\n"],"names":["__previewErrors","window","addEventListener","event","message","filename","replace","location","origin","lineno","colno","stack","error","toString","push","target","indexOf","localName","src","href","currentSrc","e","reason","errorName","args","Error","name","textUrl","key","params","search","split","arr","i","length","data","getParam","throttle","delay","noTrailing","callback","debounceMode","timeoutID","cancelled","lastExec","clearExistingTimeout","clearTimeout","wrapper","_len","arguments","arguments_","Array","_key","self","this","elapsed","Date","now","exec","apply","clear","undefined","setTimeout","cancel","decodeURIComponent","isIframe","top","isOpener","opener","urls","Liam","PopupWindowMessageManagerOrSchema","floatButtonText","wrapText","focusComponent","pos","scrollInto","isArray","join","focusElement","document","querySelector","currentElement","classList","remove","add","scrollIntoView","block","inline","render","text","js","trim","console","log","sendError","MM1","post","type","value","parent","on","el","getAttribute","parentNode","__loc"],"sourceRoot":""}